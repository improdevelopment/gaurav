---
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";
import GTM from "../../components/GTM.astro";
import GTMBody from "../../components/GTMBody.astro";
import "../../styles/global.css";
import { readdir, readFile } from 'node:fs/promises';
import { join } from 'node:path';

export const prerender = true;

// Get all HTML files from research directory and extract titles
let researchArticles: Array<{slug: string, title: string}> = [];

try {
  const researchDir = join(process.cwd(), 'research');
  const files = await readdir(researchDir);
  const htmlFiles = files.filter(file => file.endsWith('.html') && !file.startsWith('TEMPLATE'));
  
  // Read each file and extract the title
  for (const file of htmlFiles) {
    const slug = file.replace('.html', '');
    let title = slug.split('-').map(word => 
      word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' '); // Fallback title
    
    try {
      const filePath = join(researchDir, file);
      const content = await readFile(filePath, 'utf-8');
      
      // Extract title from HTML (handle multiline and whitespace)
      const titleMatch = content.match(/<title[^>]*>([\s\S]*?)<\/title>/i);
      if (titleMatch && titleMatch[1]) {
        title = titleMatch[1].trim().replace(/\s+/g, ' ');
      }
    } catch (err) {
      console.error(`Error reading ${file}:`, err);
    }
    
    researchArticles.push({ slug, title });
  }
} catch (error) {
  console.error('Error reading research directory:', error);
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <GTM />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Research Articles - Gaurav Agarwal</title>
    <meta name="description" content="In-depth research and analysis on AI, marketing, and technology by Gaurav Agarwal" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/favicon.svg"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/icon-192x192.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="192x192"
      href="/icon-192x192.png"
    />
  </head>
  <body>
    <GTMBody />
    <Navigation />
    
    <main class="research-page">
      <div class="container">
        <div class="research-header animate-fade-in-up">
          <h1 class="research-title">Research Articles</h1>
          <p class="research-subtitle">
            In-depth research and analysis on AI, marketing, and technology
          </p>
        </div>
        
        {researchArticles.length > 0 ? (
          <div class="research-grid">
            {researchArticles.map((article, index) => (
              <a 
                href={`/research/${article.slug}`} 
                class={`research-card card hover-lift animate-fade-in-up stagger-${Math.min(index + 1, 5)}`}
              >
                <div class="card-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                  </svg>
                </div>
                <h2 class="card-title">{article.title}</h2>
                <div class="card-arrow">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div class="empty-state animate-fade-in">
            <div class="empty-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
              </svg>
            </div>
            <h2 class="empty-title">No Research Articles Yet</h2>
            <p class="empty-description">
              Add HTML files to the <code>research/</code> folder to get started.
            </p>
          </div>
        )}
      </div>
    </main>
    
    <Footer />
    
    <style>
      .research-page {
        margin-top: 80px;
        min-height: calc(100vh - 80px);
        padding: 6rem 0 4rem 0;
        background: var(--color-background);
      }
      
      .research-header {
        text-align: center;
        margin-bottom: 4rem;
      }
      
      .research-title {
        font-size: 4rem;
        font-weight: 800;
        color: var(--color-primary);
        margin-bottom: 1rem;
        letter-spacing: -0.02em;
      }
      
      .research-subtitle {
        font-size: 1.25rem;
        color: var(--color-secondary);
        max-width: 600px;
        margin: 0 auto;
      }
      
      .research-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
      }
      
      .research-card {
        position: relative;
        padding: 2rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        text-decoration: none;
        transition: var(--transition-normal);
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .research-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-xl);
        border-color: var(--color-primary);
      }
      
      .card-icon {
        width: 48px;
        height: 48px;
        background: var(--color-primary);
        color: white;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition-normal);
      }
      
      .research-card:hover .card-icon {
        transform: scale(1.1);
      }
      
      .card-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--color-primary);
        line-height: 1.3;
        flex: 1;
      }
      
      .card-arrow {
        color: var(--color-secondary);
        transition: var(--transition-fast);
      }
      
      .research-card:hover .card-arrow {
        color: var(--color-primary);
        transform: translateX(4px);
      }
      
      .empty-state {
        text-align: center;
        padding: 6rem 2rem;
      }
      
      .empty-icon {
        color: var(--color-border);
        margin-bottom: 2rem;
      }
      
      .empty-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 1rem;
      }
      
      .empty-description {
        font-size: 1.125rem;
        color: var(--color-secondary);
        max-width: 500px;
        margin: 0 auto;
      }
      
      .empty-description code {
        background: var(--color-surface);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 0.9em;
        border: 1px solid var(--color-border);
      }
      
      @media (max-width: 768px) {
        .research-page {
          padding: 4rem 0;
        }
        
        .research-title {
          font-size: 2.5rem;
        }
        
        .research-subtitle {
          font-size: 1rem;
        }
        
        .research-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }
      }
    </style>
  </body>
</html>
